<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive AQI Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; }
    #input-section { 
      width: 80%; 
      margin-bottom: 20px; 
      display: flex; 
      justify-content: center; /* Center items horizontally */
      align-items: center; /* Center items vertically */
      gap: 10px; /* Space between inputs */
    }
    #map-container { display: flex;  width: 80%; } 
    #map { height: 400px; width: 70%; } 
    #sidebar { width: 30%; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd; margin-left: 20px; }
    #sidebar h2 { font-size: 1.2em; }
    #sidebar .aqi-data { margin-bottom: 10px; padding: 5px; border: 1px solid #ccc; background-color: #fff; }
    #cityInput, #stateInput, #countryInput { padding: 5px; }
<<<<<<< HEAD
    #submitBtn, #homeBtn { padding: 5px 10px; }
=======
    #submitBtn { padding: 5px 10px; }
>>>>>>> b687cf82c586d8f7bae7751dce907c3cf4730ce9
  </style>
</head>
<body>

  <h1>Real-Time AQI Map</h1>

  <!-- Input section -->
  <div id="input-section">
    <input type="text" id="cityInput" placeholder="City" required>
    <input type="text" id="stateInput" placeholder="State (optional)">
    <input type="text" id="countryInput" placeholder="Country Code (e.g., US)" required>
    <button id="submitBtn">Get AQI</button>
<<<<<<< HEAD
    <button id="homeBtn">Back to Home</button> <!-- Back to Home button -->
=======
>>>>>>> b687cf82c586d8f7bae7751dce907c3cf4730ce9
  </div>

  <!-- Container for AQI data display and map -->
  <div id="map-container">
    <!-- Map section -->
    <div id="map"></div>

    <div id="sidebar">
      <h2>Air Quality Data</h2>
      <div id="aqiDisplay"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([40.7128, -74.0060], 5);
    
    L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    async function fetchAQIData(city, state, country) {
      const response = await fetch(`/get_data?city=${city}&state=${state}&country=${country}`);
      const data = await response.json();
      if (data.error) {
        alert(data.error);
        return null;
      } else {
        // Extract air quality data
        const outputData = {
            aqi: data.list[0].main.aqi,
            components: data.list[0].components
        };
        return outputData; 
      }
    }

    function updateSidebar(city, state, country, outputData) {
      const aqiDisplay = document.getElementById("aqiDisplay");
      const locationInfo = document.createElement("div");
      locationInfo.classList.add("aqi-data");
      
      // Display AQI
      let aqiDescription;
      switch (outputData.aqi) {
          case 1:
              aqiDescription = 'Good: Air quality is considered satisfactory.';
              break;
          case 2:
              aqiDescription = 'Fair: Air quality is acceptable; however, there may be concerns for some pollutants.';
              break;
          case 3:
              aqiDescription = 'Moderate: Some pollutants may be a concern for some people.';
              break;
          case 4:
              aqiDescription = 'Poor: Air quality is likely to affect health for sensitive groups.';
              break;
          case 5:
              aqiDescription = 'Very Poor: Health warnings of emergency conditions.';
              break;
          default:
              aqiDescription = 'Data unavailable.';
      }

      locationInfo.innerHTML = `<strong>${city}, ${state ? state + ', ' : ''}${country}</strong><br><strong>AQI: ${outputData.aqi}</strong> (${aqiDescription})<br>`;
      
      // Display pollutant concentrations
      locationInfo.innerHTML += `<h4>Pollutants:</h4><ul>`;
      for (const [pollutant, value] of Object.entries(outputData.components)) {
          locationInfo.innerHTML += `<li>${pollutant.toUpperCase()}: ${value} µg/m³</li>`;
      }
      locationInfo.innerHTML += `</ul>`;
      
      aqiDisplay.innerHTML = ''; // Clear previous results
      aqiDisplay.appendChild(locationInfo);
    }

    function addMarker(lat, lng) {
      L.marker([lat, lng]).addTo(map);
      map.flyTo([lat, lng], 10, { animate: true, duration: 2 }); // Animate zooming to the marker's location
    }

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const city = document.getElementById("cityInput").value;
      const state = document.getElementById("stateInput").value;
      const country = document.getElementById("countryInput").value;

      if (city && country) {
        const { lat, lng } = await getLatLong(city, state, country);
        const outputData = await fetchAQIData(city, state, country);
        
        if (lat && lng && outputData) {
          addMarker(lat, lng); 
          updateSidebar(city, state, country, outputData); 
        }
      } else {
        alert("Please enter at least a city and country code.");
      }
    });

    async function getLatLong(city, state, country) {
      const response = await fetch(`/get_data?city=${city}&state=${state}&country=${country}`);
      const data = await response.json();
      
      if (data.error) {
        alert(data.error);
        return null;
      } else {
        const { lat, lon } = data.coord;
        return { lat, lng: lon };
      }
    }
<<<<<<< HEAD

    // Back to Home button functionality
    document.getElementById("homeBtn").addEventListener("click", function() {
        window.location.href = "/";
    });
=======
>>>>>>> b687cf82c586d8f7bae7751dce907c3cf4730ce9
  </script>
</body>
</html>
